<!DOCTYPE html>
<html>
  <head>
    <title>Socket.IO chat</title>
  </head>
  <body>
    <button onclick="joinPvP()">pvp 방 입장</button>
    <button onclick="start()">게임시작</button>
  </body>
  <script src="https://cdn.socket.io/3.1.1/socket.io.min.js"></script>
  <script>
    const socket = io.connect('http://127.0.0.1:3000', {
      transports: ['websocket'],
    });

    socket.on('connect', (server) => {
      console.log('서버와 연결되었습니다.');
    });

    socket.on('message', (data) => {
      console.log(`메세지를 수신 받았습니다. : ${data}`);
    });

    socket.on('game:tick-grid', (map) => {
      let mapString = '';

      for (let i = 0; i < map.length; i++) {
        mapString += map[i].join(' ');
        mapString += '\n';
      }

      console.clear();
      console.log(mapString);
    });

    function joinPvP() {
      socket.emit('join:pvp');
    }

    function start() {
      socket.emit('room:start');
    }

    document.addEventListener('keydown', (keyboardEvent) => {
      if (keyboardEvent.key === 'ArrowDown') {
        socket.emit('pressDownKey');
      }
      if (keyboardEvent.key === 'ArrowUp') {
        socket.emit('pressUpKey');
      }
      if (keyboardEvent.key === 'ArrowLeft') {
        socket.emit('pressLeftKey');
      }
      if (keyboardEvent.key === 'ArrowRight') {
        socket.emit('pressRightKey');
      }
      if (keyboardEvent.key === 'l') {
        socket.emit('quit', 'leave');
      }
      if (keyboardEvent.key === 'z') {
        socket.emit('pressLeftRotateKey');
      }
      if (keyboardEvent.key === 'x') {
        socket.emit('pressRightRotateKey');
      }
    });
  </script>
</html>
